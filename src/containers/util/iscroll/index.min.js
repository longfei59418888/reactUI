'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_react=require('react'),_react2=_interopRequireDefault(_react),_reactDom=require('react-dom'),_reactDom2=_interopRequireDefault(_reactDom),_styleModule=require('./style.module.scss'),_styleModule2=_interopRequireDefault(_styleModule),_iscrollProbe=require('./iscroll.js'),_iscrollProbe2=_interopRequireDefault(_iscrollProbe);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var AppComponent=function(a){function b(c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return e.state={refreshTip:0,moreTip:'\u4E0A\u62C9\u52A0\u8F7D...'},e.onRefresh=!!e.props.onRefresh&&e.props.onRefresh,e.onLoadMore=!!e.props.onLoadMore&&e.props.onLoadMore,e.canRefresh=!1,e.isRefreshIng=!1,e.canLoadMore=!1,e.loadMoreIng=!1,e.loadEnd=!1,e.doRefresh=!1,e}return _inherits(b,a),_createClass(b,[{key:'render',value:function render(){return _react2.default.createElement('div',{style:{height:'100%',width:'100%',overflow:'hidden',position:'absolute'}},_react2.default.createElement('div',{ref:'boxScroll',style:{position:'absolute',top:this.onRefresh?-60:0,width:'100%',overflow:'hidden',bottom:0}},_react2.default.createElement('div',{ref:'box'},_react2.default.createElement('div',{ref:'refresh',style:{height:60,display:this.onRefresh?'flex':'none',alignItems:'center',justifyContent:'center'}},'\u4E0B\u62C9\u5237\u65B0...'),this.props.children,_react2.default.createElement('div',{ref:'loadMore',style:{height:60,display:this.onLoadMore?'flex':'none',alignItems:'center',justifyContent:'center'}},'\u6B63\u5728\u52A0\u8F7D...'))))}},{key:'componentDidMount',value:function componentDidMount(){var d=this,c=this;c.refs.box.style['min-height']=c.refs.boxScroll.offsetHeight+1+'px',c.iScrollInstance=new _iscrollProbe2.default(c.refs.boxScroll,{probeType:3,mouseWheel:!0,disablePointer:!0,disableTouch:!1,disableMouse:!1,hasRefresh:c.onRefresh,preventDefault:!1}),c.iScrollInstance.on('scrollStartEnd',function(){d.isRefreshIng||d.loadMoreIng||(c.canRefresh&&(c.refs.refresh.innerHTML='\u6B63\u5728\u5237\u65B0...',c.isRefreshIng=!0,setTimeout(function(){c.onRefresh(c,function(e){c.refreshEnd(e)})},100)),c.canLoadMore&&!c.loadEnd&&(c.loadMoreIng=!0,setTimeout(function(){c.onLoadMore(c,function(e){c.loadMoreEnd(e)})},100)))}),c.iScrollInstance.on('scroll',function(){d.isRefreshIng||d.loadMoreIng||(c.onRefresh&&(60<c.iScrollInstance.y&&!c.canRefresh&&(!c.canRefresh&&(c.refs.refresh.innerHTML='\u677E\u624B\u5237\u65B0...'),c.canRefresh=!0),59>c.iScrollInstance.y&&c.canRefresh&&(c.canRefresh&&(c.refs.refresh.innerHTML='\u4E0B\u62C9\u5237\u65B0...'),c.canRefresh=!1)),c.onLoadMore&&!c.loadEnd&&(c.iScrollInstance.y<c.iScrollInstance.maxScrollY+80&&!c.canLoadMore&&(c.canLoadMore=!0),c.iScrollInstance.y>c.iScrollInstance.maxScrollY+80&&c.canLoadMore&&(c.canLoadMore=!1)))}),c.props.init&&0!=c.props.init.x+c.props.init.y?c.iScrollInstance.scrollTo(c.props.init.x,c.props.init.y,0):-1==c.iScrollInstance.maxScrollY&&setTimeout(function(){c.init()},100)}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(c){return c.children!=this.props.children&&(this.doRefresh=!0),!0}},{key:'componentDidUpdate',value:function componentDidUpdate(){this.doRefresh&&this.refresh(),this.doRefresh=!1}},{key:'componentWillUnmount',value:function componentWillUnmount(){-1==this.iScrollInstance.maxScrollY||this.props.leaveBefor&&this.props.leaveBefor(this.iScrollInstance)}},{key:'loadMoreEnd',value:function loadMoreEnd(c){var d=this;d.canLoadMore=!1,setTimeout(function(){c&&d.setEnd(),d.iScrollInstance.refresh(),d.loadMoreIng=!1},100)}},{key:'setEnd',value:function setEnd(){var c=this;c.refs.loadMore.innerHTML='\u52A0\u8F7D\u5B8C\u6BD5...',c.loadEnd=!0}},{key:'refresh',value:function refresh(){var c=this;setTimeout(function(){c.iScrollInstance.refresh()},100)}},{key:'refreshEnd',value:function refreshEnd(c){var d=this;d.refs.refresh.innerHTML='\u4E0B\u62C9\u5237\u65B0...',d.iScrollInstance.refreshEnd(),d.canRefresh=!1,setTimeout(function(){d.refs.loadMore.innerHTML='\u6B63\u5728\u52A0\u8F7D...',d.loadEnd=!1,c&&d.setEnd(),d.iScrollInstance.refresh(),d.isRefreshIng=!1},100)}},{key:'init',value:function init(){var c=this;!c.loadEnd&&c.onLoadMore&&(c.loadMoreIng=!0,setTimeout(function(){c.onLoadMore(c,function(d){c.loadMoreEnd(d)})},100))}}]),b}(_react2.default.Component);AppComponent.defaultProps={},exports.default=AppComponent;
